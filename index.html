<!DOCTYPE html>
<html>
<head>
  <title></title>
  <style type="text/css">
    body {
      margin: 0;
      padding: 0;
    }
  </style>
  <link rel="stylesheet" type="text/css" href="main.css">
</head>
<body>
<div id="chart"></div>
<script type="text/javascript" src="https://d3js.org/d3.v4.js"></script>
<script type="text/javascript" src="main.js"></script>
<script type="text/javascript">
var raw = [{
  "_id": "1466091583.67-989316933",
  "_rev": "1-ceb4674ca9e6145e24cb5757864cb36a",
  "timestamp": 1466091583.674364,
  "value": "22.0",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466091584.37-106185621",
  "_rev": "1-3c400db2ee15d683f0e727797148c17f",
  "timestamp": 1466091584.372547,
  "value": "22.1000003815",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466091586.39-1617268448",
  "_rev": "1-ddec6579815fe0c167c112318842b762",
  "timestamp": 1466091586.390918,
  "value": "22.0",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466091588.4-763063241",
  "_rev": "1-b52d4d15dff7a8f0ed1a6fafbbb4771b",
  "timestamp": 1466091588.403779,
  "value": "22.1000003815",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466091592.44-1953062308",
  "_rev": "1-f79e6136180bac490daf8d56ce8cd03e",
  "timestamp": 1466091592.438315,
  "value": "22.0",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466091594.46-485843130",
  "_rev": "1-42b509e18dd904b327a841af8c284acf",
  "timestamp": 1466091594.458492,
  "value": "22.1000003815",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466094071.77-1773334056",
  "_rev": "1-334e863e2487ee63a4875ffba5819367",
  "timestamp": 1466094071.770663,
  "value": "22.1000003815",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466094609.55-834935897",
  "_rev": "1-b0e9dca0fbb5a0b0046fba6ab14e94f9",
  "timestamp": 1466094609.545169,
  "value": "0.0",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466094610.06-1467925742",
  "_rev": "1-e0493e163eeb8488a535056ee8d2fdc7",
  "timestamp": 1466094610.061295,
  "value": "22.2000007629",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466094615.51-1549532371",
  "_rev": "1-1588b15c6a6176d1bbe8c329f80c78d3",
  "timestamp": 1466094615.51288,
  "value": "22.1000003815",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466094617.53-1585233982",
  "_rev": "1-2fbb6452429c98b887a40b6a47106480",
  "timestamp": 1466094617.527686,
  "value": "22.2000007629",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466094619.55-2017358128",
  "_rev": "1-b0c93bb2f51e6e365ac118033cc6ffda",
  "timestamp": 1466094619.546528,
  "value": "22.1000003815",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466094626.74-1254001844",
  "_rev": "1-48b7118c7ddde8ca2c66430c266c91f2",
  "timestamp": 1466094626.744884,
  "value": "22.2000007629",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466094629.63-1296643336",
  "_rev": "1-46949011a896d558f6ff47c0e8d75f77",
  "timestamp": 1466094629.630979,
  "value": "22.1000003815",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466094631.66-1544460545",
  "_rev": "1-1786b058f95984b1f9146d08ce1986ee",
  "timestamp": 1466094631.664638,
  "value": "22.2000007629",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466094633.67-1009809291",
  "_rev": "1-917490cfbfbece0bb089086be8e18c86",
  "timestamp": 1466094633.674649,
  "value": "22.1000003815",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466094635.68-590041682",
  "_rev": "1-d843590a603547494a34c87a27593df5",
  "timestamp": 1466094635.681755,
  "value": "22.2000007629",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466538327.12-1248333226",
  "_rev": "1-843e477bebf8f5cd6107a2507b1932ff",
  "timestamp": 1466538327.118188,
  "value": "22.2999992371",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466538761.83-912226473",
  "_rev": "1-eabb4084f364f01847afba38e2325e6a",
  "timestamp": 1466538761.833772,
  "value": "22.2999992371",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466538936.58-646112400",
  "_rev": "1-484c574f3e1e63503f95e720bf07715e",
  "timestamp": 1466538936.583721,
  "value": "22.2999992371",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466538945.71-1056052852",
  "_rev": "1-70803dbff24c9f8ffa4d844f84ed00b5",
  "timestamp": 1466538945.705043,
  "value": "22.2000007629",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466538947.73-365241024",
  "_rev": "1-69d780190cb9e3bef10d5e19cbe6a9f9",
  "timestamp": 1466538947.726429,
  "value": "22.2999992371",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466538989.09-2047139831",
  "_rev": "1-878049ebbb0bb2a5f3e4b1d9f0b3c640",
  "timestamp": 1466538989.094435,
  "value": "22.2000007629",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466539049.3-1102433017",
  "_rev": "1-98943d4bf797c76f693f1ac4757df965",
  "timestamp": 1466539049.304108,
  "value": "22.1000003815",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466539188.24-1661956778",
  "_rev": "1-b8aa0edbd353988c023bba01b0418188",
  "timestamp": 1466539188.235276,
  "value": "22.1000003815",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466539343.58-1397597437",
  "_rev": "1-2588b09ce2dd4fb1ea06da0b3af57f64",
  "timestamp": 1466539343.57729,
  "value": "22.0",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466539439.33-893377423",
  "_rev": "1-9abc98dbc5912fd687e18e070a8a9b28",
  "timestamp": 1466539439.326067,
  "value": "21.8999996185",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}, {
  "_id": "1466539647.7-1287969301",
  "_rev": "1-f79aff3ccf5176b953e207480a6ff466",
  "timestamp": 1466539647.704765,
  "value": "21.7999992371",
  "environment": "environment_1",
  "variable": "air_temperature",
  "is_desired": false
}];

const readPoint = d => ({
  x: d.timestamp,
  y: Number.parseFloat(d.value)
});

const compareByX = (a, b) =>
  a.x > b.x ? 1 : -1;

const MEASURED1 = raw
  .filter(d => d.variable === 'air_temperature')
  .map(readPoint)
  .sort(compareByX);

const DESIRED1 = raw
  .filter(d => d.variable === 'air_temperature')
  .map(d => {
    const point = readPoint(d);
    point.y = point.y + Math.sin(point.x);
    return point;
  })
  .sort(compareByX);

const MEASURED2 = MEASURED1.slice(-10);

const log = x => console.log(x);

const series = [
  {
    title: 'Water Temperature',
    color: '#00a5ed',
    desired: [],
    measured: MEASURED2,
    unit: '\xB0C'
  },
  {
    title: 'Air Temperature',
    color: '#0052b3',
    desired: DESIRED1,
    measured: MEASURED1,
    unit: '\xB0C',
    min: 7.2,
    max: 48.8
  }
];

const container = d3.select('#chart').datum(series);

const config = {
  // Duration to show within chart.
  interval: HR_MS,
  width: window.innerWidth,
  height: window.innerHeight,
  tooltipHeight: 112,
  tooltipWidth: 424,
  scrubberAt: 1.0,
  xhairAt: 0.5,
  readX,
  readY
};

enter(container, config);
update(container, config);

</script>
</body>
</html>